# System Security - 1

本文主要记录现代操作系统如何从系统层面做栈溢出或者缓冲区溢出的防护措施，包括：栈金丝雀，数据执行保护，地址空间随机化。
当然也仅仅只是防御，增加攻击者难度和门槛而已，还是有各种方法能够绕过。

## 前言

网上有太多博客或者其他材料介绍缓冲区溢出，有的甚至图文并茂。这里简单介绍以下概念。
程序执行，有专门的栈区，保存局部变量和函数地址。当用户输入没有做边界检查时，可能发生栈溢出现象，此时会向上增长覆盖函数返回地址和其他变量地址等等。
通常恶意代码会精心构造输入，使得恰好覆盖函数返回地址，使得程序指向精心构造shellcode的区域，执行恶意代码。从而达到提权和入侵的目的。

## 栈金丝雀

栈金丝雀有的也叫做stack_guard（栈守卫），意思就是在调用函数的地方，编译器在栈中插入一个金丝雀值，在返回地址之前再插入一段代码检测该值是否发生变动。
如果发生变动说明程序出错了，再采取相应措施。

绕过：  
通过逆向，去猜金丝雀的值或者，多次尝试在填充数据的时候将检测金丝雀的返回也给覆盖，进而找到函数返回值。

## 数据执行保护（DEP）

本质上大部分的恶意攻击，都是通过执行构造的shellcode实现。所以会经常听到一个词，“代码数据分离”。就是数据不能当做代码被执行。
现代CPU有一个被称之为**NX**位的功能，NX代表不执行。可以用来区分数据段（堆，栈，变量和全局变量）和文本段（包含代码）。
许多操作系统试图确保数据段是可写的，但不可执行，文本段是可执行的，但不可写的。或者其他策略，比如：执行和可写不可同时满足。

> 这部分，之后还会详细补充

## 地址空间随机化（ASLR）

地址空间随机化旨在随机化程序每次运行是所用的函数和数据的地址。这样的话使得攻击者更加难以破解系统，最重要的是成本还很低。

> 这部分，之后也会详细补充。

